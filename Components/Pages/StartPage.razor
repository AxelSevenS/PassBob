@page "/start"
@inject NavigationManager Navigation

<h3>Création de Clé</h3>

@if (masterKey is not null) {
	<h2>
		ATTENTION, CELA SUPPRIMERA TOUS LES MOTS DE PASSES QUE VOUS AVEZ DANS LE COFFRE-FORT
	</h2>
}

<EditForm Model="@loginModel" OnValidSubmit="HandleSignup">
	<DataAnnotationsValidator />
	<ValidationSummary />
	<div>
		<label for="masterKey">Master Key:</label>
		<InputText id="masterKey" @bind-Value="loginModel.MasterKey" type="password" />
	</div>
	<button type="submit">Créer Master Key</button>
</EditForm>

@code {
	private LoginModel loginModel = new();
	private string? masterKey;

	protected override async Task OnInitializedAsync() {
		masterKey = await SecureStorageService.GetEncryptedMasterKeyAsync();
	}

	private async void HandleSignup() {
		await PasswordDatabase.SetMasterKeyDestructive(loginModel.MasterKey);
		Navigation.NavigateTo("/");
	}
}
